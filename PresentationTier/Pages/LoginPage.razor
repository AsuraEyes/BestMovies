@page "/login"
@using PresentationTier.Authorization
@inject NavigationManager navigationManager
@inject AuthenticationStateProvider stateProvider
@namespace LoginComponent


<h3>Login to Best Movies</h3>
<style>
    .form-group {
        margin-bottom: 10px;
    }

    label {
        width: 200px;
        font-weight: bold;
    }

    .input-field {
        width: 200px;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    .error-message {
        color: red;
        margin-bottom: 10px;
    }

    .login-button {
        padding: 10px 20px;
        background-color: #007bff;
        color: #fff;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
</style>
<RadzenRow Gap="0" Class="rz-my-12 rz-mx-auto rz-border-radius-6 rz-shadow-10" Style="width: 100%; max-width: 800px; overflow: hidden; background-color: lightgrey;">
    <RadzenColumn Size="12" SizeMD="6">
        <RadzenCard Class="rz-shadow-0 rz-border-radius-0 rz-text-align-center rz-p-12" Style="height: 100%; background-color: lightgrey;">
            <RadzenText TextStyle="TextStyle.DisplayH3" TagName="TagName.H2" Class="rz-color-white rz-mb-6">Welcome!</RadzenText>
            <RadzenText TextStyle="TextStyle.H6" Class="rz-color-white">Join us at BestMovies and embark on a cinematic journey that will leave you captivated, informed, and inspired</RadzenText>
            <RadzenText TextStyle="TextStyle.Body2" Class="rz-color-white">Let the magic of movies unfold right at your fingertips</RadzenText>
        </RadzenCard>
    </RadzenColumn>
    <RadzenColumn Size="12" SizeMD="6">
        <RadzenCard Class="rz-shadow-0 rz-border-radius-0 rz-p-12">
            <RadzenText TextStyle="TextStyle.H5" TagName="TagName.H2" Class="rz-mb-6">
                Login
            </RadzenText>
            <div class="form-group">
                <label>E-mail:</label>
                <input type="text" placeholder="email" class="input-field" @bind-value="email" />
            </div>
            <div class="form-group">
                <label>Password:</label>
                <input type="password" placeholder="password" class="input-field" @bind-value="password" />
            </div>
            <div class="error-message">@errorMessage</div>
            <button class="login-button" @onclick="PerformLogin">Login</button>
            <button class="login-button" @onclick="RegisterUser">Register</button>

        </RadzenCard>
    </RadzenColumn>
</RadzenRow>
@code {
    private string email;
    private string password;
    private string? errorMessage;

    private async Task PerformLogin()
    {
        errorMessage = "";
        try
        {
            await ((CustomAuthenticationStateProvider)stateProvider).ValidateLogin(email, password);
            email = "";
            password = "";
            navigationManager.NavigateTo("/");

        }
        catch (Exception e)
        {
            errorMessage = "Login failed. Please check your credentials and try again.";
        }
    }

    private async Task PerformLogout()
    {
        errorMessage = "";
        email = "";
        password = "";
        try
        {
            await ((CustomAuthenticationStateProvider)stateProvider).Logout();
            navigationManager.NavigateTo("/");
        }
        catch (Exception e) { }
    }
    private async Task RegisterUser()
    {
        navigationManager.NavigateTo("/register");
    }
}
