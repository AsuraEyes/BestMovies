@page "/"
@using PresentationTier.Models
@using PresentationTier.Data.Media

@inject NavigationManager NavigationManager

@inject IMediaService MediaService

<PageTitle>Home</PageTitle>
<RadzenStack Gap="45" Style="width: 1720px; padding-left: 10%; padding-right: 10%">
    <RadzenStack Style="max-height: 750px; margin-bottom: 150px">
        <RadzenStack Style="background-color: rgba(0, 0, 0, 0.8)">
            <RadzenImage Path="@backdrop" Style="border-radius: 10px; opacity: 40%; mask-image: linear-gradient(to top, transparent 150px, black); pointer-events: none"/>
            <RadzenStack Gap="0" Style="color: #ffffff; position: relative; bottom: 50%">
                <RadzenText Text="BestMovies Inc." TextStyle="TextStyle.DisplayH4" Style="color: #ffffff" TextAlign="TextAlign.Center"/>
                <RadzenText Text="The Number One site for media and reviews" TextStyle="TextStyle.Subtitle2" Style="color: #edd4d4" TextAlign="TextAlign.Center"/>
            </RadzenStack>
        </RadzenStack>
    </RadzenStack>
    
    <RadzenStack Orientation="Orientation.Horizontal" Gap="0" Style="position: relative" JustifyContent="JustifyContent.Center">
        <RadzenTextBox Placeholder="Search..." @bind-Value="@search" Style="border-radius: 25px 0 0 25px; border: 1px solid rgb(33, 33, 33); width: 500px"/>
        <RadzenButton Style="border-radius: 0 25px 25px 0;" ButtonStyle="ButtonStyle.Dark" Icon="search" Variant="Variant.Outlined" Click="SearchMedia"/>
    </RadzenStack>

    <RadzenStack Style="width: 1320px; position: relative" Gap="0">
        <RadzenText TextStyle="TextStyle.H5">Trending</RadzenText>
        <RadzenStack Orientation="Orientation.Horizontal" Gap="15" Style="overflow-y: auto">
            @foreach (var item in media)
            {
                @if (item.Type.Equals("movie"))
                {
                    <RadzenStack>
                        <RadzenCard onclick="@(() => NavigateToMovie(item.Id))" Style="padding: 0; min-width: 150px; max-width: 150px; min-height: 225px; border-radius: 10px">
                            <RadzenImage Path="@item.Poster" Style="max-width: 100%; min-height: 100%; border-radius: 10px"/>
                        </RadzenCard>
                        <RadzenText>@item.Title</RadzenText>
                    </RadzenStack>
                }
                else
                {
                    <RadzenStack>
                        <RadzenCard onclick="@(() => NavigateToTVShow(item.Id))" Style="padding: 0; min-width: 150px; max-width: 150px; min-height: 225px; border-radius: 10px">
                            <RadzenImage Path="@item.Poster" Style="max-width: 100%; min-height: 100%; border-radius: 10px"/>
                        </RadzenCard>
                        <RadzenText>@item.Name</RadzenText>
                    </RadzenStack>
                }
            }
        </RadzenStack>
    </RadzenStack>
    
    <RadzenStack Style="width: 1320px; position: relative" Gap="0">
        <RadzenText TextStyle="TextStyle.H5">Now Playing</RadzenText>
        <RadzenStack Orientation="Orientation.Horizontal" Gap="15" Style="overflow-y: auto">
            @foreach (var movie in movies)
            {
                <RadzenStack>
                    <RadzenCard onclick="@(() => NavigateToMovie(movie.Id))" Style="padding: 0; min-width: 150px; max-width: 150px; min-height: 225px; border-radius: 10px">
                        <RadzenImage Path="@movie.Poster" Style="max-width: 100%; min-height: 100%; border-radius: 10px"/>
                    </RadzenCard>
                    <RadzenText>@movie.Title</RadzenText>
                </RadzenStack>
            }
        </RadzenStack>
        <RadzenButton Variant="Variant.Text" ButtonStyle="ButtonStyle.Dark" Text="All Movies" Style="text-align: left" Click="NavigateToMovies"/>
    </RadzenStack>
    
    <RadzenStack Style="width: 1320px; position: relative" Gap="0">
        <RadzenText TextStyle="TextStyle.H5">Airing Today</RadzenText>
        <RadzenStack Orientation="Orientation.Horizontal" Gap="15" Style="overflow-y: auto">
            @foreach (var tv in shows)
            {
                <RadzenStack>
                    <RadzenCard onclick="@(() => NavigateToTVShow(tv.Id))" Style="padding: 0; min-width: 150px; max-width: 150px; min-height: 225px; border-radius: 10px">
                        <RadzenImage Path="@tv.Poster" Style="max-width: 100%; min-height: 100%; border-radius: 10px"/>
                    </RadzenCard>
                    <RadzenText>@tv.Name</RadzenText>
                </RadzenStack>
            }
        </RadzenStack>
    </RadzenStack>
</RadzenStack>

@code {
    private Media[] media = {};
    private Media[] movies = {};
    private Media[] shows = {};
    private string search = "";
    private string backdrop = "";

    protected override async Task OnInitializedAsync()
    {
        var rnd = new Random();
        var img   = rnd.Next(10);
        media = await MediaService.GetTrendingAsync();
        movies = await MediaService.GetMoviesAsync();
        shows = await MediaService.GetTVShowsAsync();
        backdrop = media[img].Backdrop;
    }
    private void SearchMedia()
    {
        NavigationManager.NavigateTo($"search?query={search}");
    }
    
    private void NavigateToMovie(int id)
    {
        NavigationManager.NavigateTo($"movie/{id}");
    }
    
    private void NavigateToMovies()
    {
        NavigationManager.NavigateTo("movie");
    }
    
    private void NavigateToTVShow(int id)
    {
        NavigationManager.NavigateTo($"tv/{id}");
    }
}