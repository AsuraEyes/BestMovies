@page "/tv/{Id:int}/reviews"
@using PresentationTier.Models
@using System.Globalization
@using PresentationTier.Data.Media

@inject NavigationManager NavigationManager

@inject ITVService TVService

<PageTitle>@tv.Name - Reviews</PageTitle>
<RadzenStack Gap="30">
    <RadzenRow Style="height: 117px">
        <RadzenStack Orientation="Radzen.Orientation.Horizontal" Style="width: 100%">
            <RadzenImage Path="@tv.Poster" Style="max-height: 125px; padding-left: 5px; padding-top: 5px; padding-bottom: 5px"/>
            <RadzenStack Gap="0" Style="width: 100%">
                <RadzenText Style="margin-top: 15px" TextStyle="TextStyle.DisplayH4">
                    <RadzenLink Path="@NavigateToTVShow(Id)" Style="color: rgb(40,54,60)">@tv.Name</RadzenLink> (@tv.Premiere.Year)
                </RadzenText>
                <RadzenLink Text="← Back to main" Path="@NavigateToTVShow(Id)"/>
            </RadzenStack>
        </RadzenStack>
    </RadzenRow>

    <RadzenRow>
        <RadzenStack Orientation="Radzen.Orientation.Horizontal" Style="width: 100%">
            <RadzenButton Text="Write Review" Variant="Variant.Outlined" ButtonStyle="ButtonStyle.Dark" Icon="edit" Style="border-radius: 25px; max-height: 36px"/>
            <RadzenStack Gap="25">
                @foreach (var review in GetReviews())
                {
                    <RadzenCard Style="border-radius: 10px; max-width: 650px; min-width: 650px">
                        <RadzenStack Orientation="Radzen.Orientation.Horizontal">
                            <RadzenImage Path="https://bootdey.com/img/Content/avatar/avatar6.png" Style="width: 50px; border-radius: 50%"/>
                            <RadzenStack Gap="0" Style="width: 100%">
                                <RadzenRow Gap="5">
                                    <RadzenText TextStyle="TextStyle.DisplayH6">@review.Title</RadzenText>
                                    <RadzenButton Size="ButtonSize.Small" Text="@review.Rating.ToString(CultureInfo.InvariantCulture)" Style="display: inline-block; position: relative; top: -5px" ButtonStyle="ButtonStyle.Dark" Icon="grade" />
                                </RadzenRow>
                                <RadzenRow Gap="5">
                                    <RadzenText TextStyle="TextStyle.Caption">
                                        <RadzenLink Click="">@User.Username</RadzenLink>
                                    </RadzenText>
                                    <RadzenText TextStyle="TextStyle.Caption">
                                        @review.Created.ToString("dd MMMM yyyy")
                                    </RadzenText>
                                </RadzenRow>
                            </RadzenStack>
                        </RadzenStack>
                        <RadzenText Style="padding-top: 10px">@review.Description</RadzenText>
                    </RadzenCard>
                }
            </RadzenStack>
        </RadzenStack>
    </RadzenRow>
</RadzenStack>

@code {
    [Parameter]
    public int Id { get; set; }

    private User User = new(){Username = "John Doe", Joined = new DateTime(2022, 4, 12)};
    private TV tv = new();

    protected override async Task OnInitializedAsync()
    {
        tv = await TVService.GetTVAsync(Id);
    }

    private List<Review> GetReviews()
    {
        List<Review> reviews = new()
        {
            new Review{Title = "Test Review", Rating = 4.5, Description = "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum."},
            new Review{Title = "Test Review", Rating = 3.5, Description = "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum."}
        };
        return reviews;
    }
    
    private string NavigateToTVShow(int id)
    {
        return $"tv/{id}";
    }
}