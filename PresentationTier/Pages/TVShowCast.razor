@page "/tv/{Id:int}/cast"
@using PresentationTier.Data.Media
@using PresentationTier.Models
@using Orientation = Radzen.Orientation

@inject NavigationManager NavigationManager

@inject ITVService TVService

<PageTitle>@tv.Name - Cast</PageTitle>
<RadzenStack Style="width: 1720px" Gap="45">
    <RadzenStack Style="width: 100%; max-height: 200px; background-color: rgba(0, 0, 0, 0.8)">
        <RadzenImage Path="@tv.Backdrop" Style="opacity: 40%; mask-image: linear-gradient(to top, transparent 750px, black); pointer-events: none"/>
        <RadzenStack Orientation="Orientation.Horizontal" Style="position: absolute; margin: 45px 160px; width: 1400px">
            <RadzenImage Path="@tv.Poster" Style="max-height: 125px; padding-left: 5px; padding-top: 5px; padding-bottom: 5px"/>
            <RadzenStack Gap="0" Style="width: 100%">
                <RadzenText Style="margin-top: 15px; color: #ffffff; font-weight: 100" TextStyle="TextStyle.DisplayH4">
                    <RadzenLink Path="@NavigateToTV(Id)" Style="color: #ffffff; font-weight: 600">@tv.Name</RadzenLink> (@tv.Premier.Year)
                </RadzenText>
                <RadzenLink Text="← Back to main" Path="@NavigateToTV(Id)"/>
            </RadzenStack>
        </RadzenStack>
    </RadzenStack>

    <RadzenStack Orientation="Orientation.Horizontal">
        <RadzenStack Gap="15" Style="width: 700px; margin: 45px 160px">
            <RadzenText Text="Cast" TextStyle="TextStyle.DisplayH5"/>
            @foreach (var actor in cast)
            {
                <RadzenStack Orientation="Orientation.Horizontal" onclick="@(() => NavigateToCastMember(actor.Id))">
                    <RadzenImage Path="@actor.Picture" Style="height: 75px"/>
                    <RadzenStack Gap="0" Style="margin-top: 5px; margin-bottom: 5px">
                        <RadzenText Text="@actor.Name"/>
                        <RadzenText Text="@actor.Character"/>
                    </RadzenStack>
                </RadzenStack>
            }
        </RadzenStack>
        <RadzenStack  Gap="15" Style="width: 700px; margin: 45px 160px">
            <RadzenText Text="Crew" TextStyle="TextStyle.DisplayH5"/>
            @foreach (var member in crew)
            {
                <RadzenStack Orientation="Orientation.Horizontal" onclick="@(() => NavigateToCastMember(member.Id))">
                    <RadzenImage Path="@member.Picture" Style="height: 75px"/>
                    <RadzenStack Gap="0" Style="margin-top: 5px; margin-bottom: 5px">
                        <RadzenText Text="@member.Name"/>
                        <RadzenText Text="@member.Job"/>
                    </RadzenStack>
                </RadzenStack>
            }
        </RadzenStack>
    </RadzenStack>
</RadzenStack>

@code {
    [Parameter]
    public int Id { get; set; }

    private TV tv = new();
    private Person[] cast = {};
    private Person[] crew = {};

    protected override async Task OnInitializedAsync()
    {
        tv = await TVService.GetTVAsync(Id);
        cast = tv.Credits.Cast;
        crew = tv.Credits.Crew;
    }
    
    private static string NavigateToTV(int id)
    {
        return $"tv/{id}";
    }
    
    private void NavigateToCastMember(int id)
    {
        NavigationManager.NavigateTo($"/person/{id}");
    }
}